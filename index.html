<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>YELO Dashboard</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
  <script>
    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Firebase Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±ÙŠØ¹
    window.addEventListener('load', function() {
      const loadingScreen = document.getElementById('loadingScreen');
      
      setTimeout(() => {
        // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Firebase Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        window.location.replace('https://yelo-dashboard.web.app/');
      }, 4000);
    });
    
    function logout() {
      localStorage.removeItem('isAuthenticated');
      localStorage.removeItem('userName');
      localStorage.removeItem('userRole');
      window.location.href = 'login.html';
    }
    
    function scrollToDashboard() {
      document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
    }
    
    function checkPermissionAndNavigate(permission, url) {
      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‡Ù†Ø§
      window.open(url, '_blank');
    }
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" />
  <link href="css/styles.css" rel="stylesheet" />
  <style>
    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #6a1b9a 0%, #ffd600 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      flex-direction: column;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: white;
      font-size: 18px;
      font-weight: bold;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    .user-bar {
      position: fixed;
      top: 0;
      right: 0;
      background: rgba(106, 27, 154, 0.95);
      color: white;
      padding: 10px 20px;
      border-radius: 0 0 0 15px;
      z-index: 1000;
      display: none;
      align-items: center;
      gap: 15px;
      backdrop-filter: blur(10px);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn {
      background: rgba(255, 214, 0, 0.2);
      border: 1px solid #ffd600;
      color: #ffd600;
      padding: 5px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
    }

    .logout-btn:hover {
      background: #ffd600;
      color: #6a1b9a;
    }

    .admin-btn {
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid #ff4444;
      color: #ff4444;
      padding: 5px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      text-decoration: none;
    }

    .admin-btn:hover {
      background: #ff4444;
      color: white;
    }

    .custom-btn {
      display: inline-block;
      background-color: #ffd600;
      color: #6a1b9a;
      padding: 15px 30px;
      font-size: 40px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      text-decoration: none;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
    }

    .custom-btn:hover {
      transform: scale(1.05);
      box-shadow: 0px 6px 12px rgba(0,0,0,0.3);
    }

    .portfolio-card {
      margin: 20px;
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      background-color: #fff;
      transition: transform 0.2s;
    }

    .portfolio-card:hover {
      transform: scale(1.03);
    }

    .portfolio-card img {
      border-radius: 15px;
      width: 100%;
      height: auto;
    }

    header.masthead {
      padding: 60px 0;
    }

    @keyframes popIn {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .reminder-card {
      background-color: #fdd835;
      color: #4a148c;
      padding: 24px 36px;
      border-radius: 18px;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      border: 2px solid #6a1b9a;
      box-shadow: 0 6px 18px rgba(106, 27, 154, 0.5);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: popIn 0.5s ease;
    }

    .reminder-card:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body id="page-top">
  <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading YELO Dashboard...</div>
    <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-top: 10px;">Please wait while we prepare your dashboard</div>
  </div>

  <!-- User Bar -->
  <div id="userBar" class="user-bar">
    <div class="user-info">
      <i class="fas fa-user-circle"></i>
      <span id="userName">User</span>
    </div>
    <a href="admin.html" class="admin-btn" id="adminBtn" style="display: none;">
      <i class="fas fa-cog"></i> Admin
    </a>
    <button class="logout-btn" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
    <button class="logout-btn" onclick="clearAuth()" style="margin-left: 5px; background: rgba(255,0,0,0.2); border-color: #ff4444; color: #ff4444;">
      <i class="fas fa-trash"></i> Clear Auth
    </button>
  </div>

  <!-- Navigation -->
  <a class="menu-toggle rounded" href="#"><i class="fas fa-bars"></i></a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand"><a href="#page-top">Mohamed Alamir</a></li>
      <li class="sidebar-nav-item"><a href="#page-top">Home</a></li>
      <li class="sidebar-nav-item"><a href="#dashboard">Dashboard</a></li>
      <li class="sidebar-nav-item"><a href="#contact">Contact</a></li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="masthead d-flex align-items-center">
    <div class="container px-10 px-lg-5 text-center" style="margin-top: 240px;">
      <button class="custom-btn" onclick="scrollToDashboard()">Start</button>
    </div>
  </header>

  <!-- Dashboard Section -->
  <section class="content-section" id="dashboard">
    <div class="container px-4 px-lg-5">
      <div class="row justify-content-center">

        <div style="display: flex; justify-content: center; margin-bottom: 30px; gap: 20px;">
          <div class="reminder-card" onclick="checkPermissionAndNavigate('operations', 'https://moalamir52.github.io/Operations_Portal/')">
            ğŸ“¢ Operations Portal
          </div>
          <div class="reminder-card" onclick="checkPermissionAndNavigate('contracts', 'https://moalamir52.github.io/Contract_Matcher/')" style="display: flex; align-items: center; cursor: pointer;">
            ğŸ“ Contract Matcher
          </div>
          <div class="reminder-card" onclick="checkPermissionAndNavigate('staff', 'https://moalamir52.github.io/Staff/')" style="display: flex; align-items: center; cursor: pointer;">
            ğŸ‘¥ Staff Status
          </div>
        </div>

        <!-- Business Bay Contracts Card -->
        <div class="col-md-5 portfolio-card">
          <div onclick="checkPermissionAndNavigate('contracts', 'https://moalamir52.github.io/contracts/')" style="cursor: pointer;">
            <img src="assets/img/Business Bay Contracts.jpg" alt="Business Bay Contracts" />
          </div>
        </div>

        <div class="col-md-5 portfolio-card">
          <div onclick="checkPermissionAndNavigate('maintenance', 'https://moalamir52.github.io/maintenance/')" style="cursor: pointer;">
            <img src="assets/img/Cars Maintenance.jpg" alt="Cars Maintenance" />
          </div>
        </div>

        <div class="col-md-5 portfolio-card">
          <div onclick="checkPermissionAndNavigate('reports', 'https://moalamir52.github.io/car-report/')" style="cursor: pointer;">
            <img src="assets/img/Reports.jpg" alt="Reports" />
          </div>
        </div>

        <div class="col-md-5 portfolio-card">
          <div onclick="checkPermissionAndNavigate('summary', 'https://moalamir52.github.io/Summary/')" style="cursor: pointer;">
            <img src="assets/img/Maintenance Done.jpg" alt="Maintenance Done" />
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Map -->
  <div class="map" id="contact">
    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3610.5008778999018!2d55.26266812407037!3d25.186325832139893!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3e5f69b4df276c75%3A0x9dc2da4dd1a0a797!2sThe%20Regal%20Tower!5e0!3m2!1sar!2sae!4v1747455116340!5m2!1sar!2sae" width="800" height="600" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    <br />
    <small>
      <a href="https://www.google.com/maps/place/YELO+Car+Rental+Muscat+Airport/" target="_blank">
        View larger map
      </a>
    </small>
  </div>

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container px-4 px-lg-5">
      <ul class="list-inline mb-5">
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#!"><i class="icon-social-facebook"></i></a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#!"><i class="icon-social-twitter"></i></a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white" href="#!"><i class="icon-social-github"></i></a>
        </li>
      </ul>
      <p class="text-muted small mb-0">Copyright to Mohamed Alamir 2025</p>
    </div>
  </footer>

  <!-- Scroll to Top -->
  <a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/scripts.js"></script>

  <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© -->
  <script>
    let currentAuthData = null;

    // ÙØ­Øµ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    function checkAuth() {
      console.log('ğŸ” Starting authentication check...');
      const authData = localStorage.getItem('yelo_auth');
      console.log('ğŸ“‹ Raw auth data from localStorage:', authData);
      
      if (authData) {
        try {
          const parsed = JSON.parse(authData);
          console.log('ğŸ“ Parsed auth data:', parsed);
          const now = new Date().getTime();
          console.log('â° Current time:', now, 'Expiry time:', parsed.expiry);
          
          if (parsed.expiry && now < parsed.expiry) {
            console.log('âœ… Auth data is valid and not expired');
            return parsed;
          } else {
            console.log('â° Auth data expired, removing from localStorage');
            localStorage.removeItem('yelo_auth');
          }
        } catch (error) {
          console.error('ğŸ’¥ Error parsing auth data:', error);
          localStorage.removeItem('yelo_auth');
        }
      } else {
        console.log('âŒ No auth data found in localStorage');
      }
      return null;
    }

    // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    function hasPermission(projectName, userPermissions) {
      if (userPermissions.includes('all')) return true;
      return userPermissions.includes(projectName);
    }

    // Log Activity
    function logActivity(user, action, details) {
      const activity = {
        user: user,
        action: action,
        details: details,
        timestamp: new Date().toISOString()
      };
      
      const activities = JSON.parse(localStorage.getItem('yelo_activities') || '[]');
      activities.push(activity);
      
      if (activities.length > 100) {
        activities.splice(0, activities.length - 100);
      }
      
      localStorage.setItem('yelo_activities', JSON.stringify(activities));
    }

    // ÙØ­Øµ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ”„ Page loaded, checking authentication...');
      const loadingScreen = document.getElementById('loadingScreen');
      const userBar = document.getElementById('userBar');
      const userName = document.getElementById('userName');
      const adminBtn = document.getElementById('adminBtn');
      
      try {
        console.log('ğŸ“‹ Checking localStorage for auth data...');
        
        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØµØ§Ø¯Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯
        if (!localStorage.getItem('yelo_auth')) {
          console.log('ğŸ”§ Creating demo auth data...');
          const demoAuth = {
            user: {
              username: 'Demo User',
              role: 'admin'
            },
            permissions: ['all'],
            expiry: new Date().getTime() + (24 * 60 * 60 * 1000) // 24 hours
          };
          localStorage.setItem('yelo_auth', JSON.stringify(demoAuth));
        }
        
        currentAuthData = checkAuth();
        console.log('ğŸ” Auth data result:', currentAuthData);
        
        if (!currentAuthData) {
          console.log('âŒ No valid authentication found, redirecting to login...');
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 1500);
          return;
        }
        
        console.log('âœ… Authentication valid, setting up user interface...');
        userName.textContent = currentAuthData.user.username;
        console.log('ğŸ‘¤ Username set:', currentAuthData.user.username);
        
        if (currentAuthData.user.role === 'admin') {
          console.log('ğŸ”§ Admin role detected, showing admin button');
          adminBtn.style.display = 'inline-block';
        }
        
        logActivity(currentAuthData.user.username, 'page_visit', 'Dashboard access');
        console.log('ğŸ“ Activity logged');
        
        setTimeout(() => {
          console.log('ğŸ¨ Hiding loading screen, showing user bar');
          loadingScreen.style.display = 'none';
          userBar.style.display = 'flex';
        }, 1000);
        
      } catch (error) {
        console.error('ğŸ’¥ Authentication check error:', error);
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      }
    });

    // Logout Function
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        if (currentAuthData) {
          logActivity(currentAuthData.user.username, 'logout', 'Logout from dashboard');
        }
        localStorage.removeItem('yelo_auth');
        window.location.href = 'login.html';
      }
    }

    // Clear Auth Function (for testing)
    function clearAuth() {
      console.log('ğŸ—‘ï¸ Clearing auth data for testing...');
      localStorage.removeItem('yelo_auth');
      location.reload();
    }

    // Scroll to Dashboard
    function scrollToDashboard() {
      document.getElementById("dashboard").scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // Check Permission and Navigate
    function checkPermissionAndNavigate(projectName, url) {
      if (!currentAuthData) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
      }
      
      if (hasPermission(projectName, currentAuthData.permissions)) {
        logActivity(currentAuthData.user.username, 'project_access', `Access to project: ${projectName}`);
        window.location.href = url;
      } else {
        alert('You do not have permission to access this project. Contact the administrator.');
      }
    }
  </script>
</body>
</html>